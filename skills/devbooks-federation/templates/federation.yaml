# DevBooks cross-repo federation config template
# Purpose: define multi-repo dependencies and impact-analysis boundaries
#
# Install:
#   cp this-file .devbooks/federation.yaml
#   # or
#   cp this-file dev-playbooks/federation.yaml
#
# Usage:
#   - devbooks-impact-analysis auto-detects this file and analyzes cross-repo boundaries
#   - guardrail-check.sh --check-federation verifies federation constraints

# Federation config version
version: "1.0"

# Current repository info
current:
  name: "my-service"
  type: "service"  # service | library | shared | monorepo-package
  owner: "team-a"

# Upstream dependencies (repos this repo depends on)
upstreams:
  - name: "shared-types"
    repo: "org/shared-types"
    # Optional: specify the exact modules/APIs depended on
    contracts:
      - "src/types/user.ts"
      - "src/types/order.ts"
    # Version constraint
    version: "^2.0.0"
    # Change notification
    notify_on_change: true

  - name: "auth-sdk"
    repo: "org/auth-sdk"
    contracts:
      - "src/client.ts"
    version: ">=1.5.0"

# Downstream consumers (repos that depend on this repo)
downstreams:
  - name: "web-app"
    repo: "org/web-app"
    # Contracts exposed to this consumer
    contracts:
      - "src/api/v1/**"
      - "src/events/published.ts"

  - name: "mobile-app"
    repo: "org/mobile-app"
    contracts:
      - "src/api/v1/**"

# Federation rules
rules:
  # Contract change rules
  contract_change:
    # Change types that must notify downstream consumers
    notify_types:
      - breaking    # breaking changes
      - deprecation # deprecation notices
    # Notification channels
    notify_channels:
      - github_issue  # create an issue in downstream repos
      - slack         # send Slack notification (requires webhook)

  # Version compatibility
  compatibility:
    # Minimum number of prior versions to support
    min_supported_versions: 2
    # Minimum days from deprecation to removal
    deprecation_period_days: 30

  # Impact analysis boundary
  impact_analysis:
    # Max analysis depth (how many repos deep)
    max_depth: 2
    # Whether to include test code
    include_tests: false

# Local development (optional)
local_dev:
  # Local repository path mapping
  paths:
    shared-types: "../shared-types"
    auth-sdk: "../auth-sdk"
  # Whether to use local linking
  use_local_links: true
